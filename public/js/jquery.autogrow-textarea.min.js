(function(a){a.fn.autogrow=function(b){return this.filter("textarea").each(function(){var d=this;var f=a(d);var e=f.height();var c=f.hasClass("autogrow-short")?0:parseInt(f.css("lineHeight"))||0;var h=a("<div></div>").css({position:"absolute",top:-10000,left:-10000,width:f.width(),fontSize:f.css("fontSize"),fontFamily:f.css("fontFamily"),fontWeight:f.css("fontWeight"),lineHeight:f.css("lineHeight"),resize:"none","word-wrap":"break-word"}).appendTo(document.body);var g=function(i){var k=function(l,o){for(var m=0,n="";m<o;m++){n+=l}return n};var j=d.value.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/ {2,}/g,function(l){return k("&nbsp;",l.length-1)+" "});if(i&&i.data&&i.data.event==="keydown"&&i.keyCode===13){j+="<br />"}h.css("width",f.width());h.html(j+(c===0?"...":""));f.height(Math.max(h.height()+c,e))};f.change(g).keyup(g).keydown({event:"keydown"},g);a(window).resize(g);g()})}})(jQuery);